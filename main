CREATE DATABASE katastima;
USE katastima;
CREATE TABLE PELATHS(TAYTOTHTA CHAR(8),EPITHETO VARCHAR(25),ONOMA VARCHAR(20),TILEFONO CHAR(10),HLIKIA INT(3),
                     PRIMARY KEY(TAYTOTHTA,EPITHETO,ONOMA,TILEFONO));
CREATE TABLE KATHGORIA (ONOMA_KATHGORIAS VARCHAR(20) NOT NULL,MEGETHOS VARCHAR(15), PRIMARY KEY(ONOMA_KATHGORIAS));
CREATE TABLE OXHMA(ARITHMOS_PINAKIDON CHAR(7),ONOMA_KATHGORIAS VARCHAR(20),XROMA VARCHAR(15),MONTELO VARCHAR(20),
                   PRIMARY KEY(ARITHMOS_PINAKIDON),
                   FOREIGN KEY (ONOMA_KATHGORIAS) REFERENCES KATHGORIA(ONOMA_KATHGORIAS));
CREATE TABLE SERVICE (KOSTOS FLOAT (4.2), XRONOS TIME ,  ARITHMOS_PINAKIDON CHAR(7), 
                      FOREIGN KEY(ARITHMOS_PINAKIDON) REFERENCES OXHMA(ARITHMOS_PINAKIDON));
CREATE TABLE ANTIPROSOPEIA ( ONOMA VARCHAR(20) , MONTELO VARCHAR(20), TIMH FLOAT (7,2), TOPOTHESIA VARCHAR(20),PRIMARY KEY(ONOMA));
CREATE TABLE KRATISI(HMEROMHNIA DATE,TAYTOTHTA CHAR(8),EPITHETO VARCHAR(25), ONOMA VARCHAR(20), TILEFONO CHAR(10), ARITHMOS_PINAKIDON CHAR(7),
                      FOREIGN KEY (TAYTOTHTA,EPITHETO,ONOMA,TILEFONO) REFERENCES PELATHS(TAYTOTHTA,EPITHETO,ONOMA,TILEFONO),
                     FOREIGN KEY (ARITHMOS_PINAKIDON) REFERENCES OXHMA(ARITHMOS_PINAKIDON));
CREATE TABLE EKPTOSI(TAYTOTHTA CHAR(8), KRATISEIS INT(2), HMEROMHNIA_EGGRAFIS DATE, HMEROMHNIA_KRATHSHS DATE,
                     FOREIGN KEY (TAYTOTHTA) REFERENCES PELATHS(TAYTOTHTA));



/*inserts*/

INSERT INTO PELATHS(TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,HLIKIA) VALUES ('AM415022','PAPADOPOULOS','IOANNIS','6985404011','37');
INSERT INTO PELATHS(TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,HLIKIA) VALUES ('AM415322','PAPAIOANNOY','DIMITRIS','6907453892','45');
INSERT INTO PELATHS(TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,HLIKIA) VALUES ('AM415029','KOUTSOS','ASIMAKIS','6984366940','55');
INSERT INTO PELATHS(TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,HLIKIA) VALUES ('AM415370','DELIOS','NIKOS','6972460618','32');
INSERT INTO PELATHS(TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,HLIKIA) VALUES ('AM415001','ANASTASOPOULOS','VASILEIOS','6985844422','42');
INSERT INTO PELATHS(TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,HLIKIA) VALUES ('AM415112','KOLOVOS','VASILEIOS','6985404117','28');
INSERT INTO PELATHS(TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,HLIKIA) VALUES ('AM415220','VITTAS','ANTONIS','6975104118','33');
INSERT INTO PELATHS(TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,HLIKIA) VALUES ('AM415347','KARANASIOU','MARIA','6982252002','27');
INSERT INTO PELATHS(TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,HLIKIA) VALUES ('AM415421','AGGELIDOU','DIMITRA','6982250222','29');
INSERT INTO PELATHS(TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,HLIKIA) VALUES ('AM415505','AGGELIDOU','GEORGIA','6987407222','32');
INSERT INTO PELATHS(TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,HLIKIA) VALUES ('AM415773','PAPADOPOULOS','KOSTANTINOS','6948333021','52');


INSERT INTO KATHGORIA(ONOMA_KATHGORIAS,MEGETHOS) VALUES ('AUTOKINHTO','MESAIO');
INSERT INTO KATHGORIA(ONOMA_KATHGORIAS,MEGETHOS) VALUES ('FORTHGO','MEGALO');
INSERT INTO KATHGORIA(ONOMA_KATHGORIAS,MEGETHOS) VALUES ('MHXANAKI','MIKRO');
INSERT INTO KATHGORIA(ONOMA_KATHGORIAS,MEGETHOS) VALUES ('TROXOSPITO','MEGALO');
INSERT INTO KATHGORIA(ONOMA_KATHGORIAS,MEGETHOS) VALUES ('BAN','MESAIO');
INSERT INTO KATHGORIA(ONOMA_KATHGORIAS,MEGETHOS) VALUES ('LIMOUZINA','MESAIO');
INSERT INTO KATHGORIA(ONOMA_KATHGORIAS,MEGETHOS) VALUES ('MINIBUS','MEGALO');
INSERT INTO KATHGORIA(ONOMA_KATHGORIAS,MEGETHOS) VALUES ('CAMPRIO','MESAIO');


INSERT INTO OXHMA(ARITHMOS_PINAKIDON,ONOMA_KATHGORIAS,XROMA,MONTELO) VALUES ('EER5027','AUTOKINHTO','KOKKINO','FERRARI');
INSERT INTO OXHMA(ARITHMOS_PINAKIDON,ONOMA_KATHGORIAS,XROMA,MONTELO) VALUES ('EER5085','AUTOKINHTO','LEUKO','HONDA CIVIC');
INSERT INTO OXHMA(ARITHMOS_PINAKIDON,ONOMA_KATHGORIAS,XROMA,MONTELO) VALUES ('EER5107','AUTOKINHTO','MAURO','PANAMERA PORSCHE');
INSERT INTO OXHMA(ARITHMOS_PINAKIDON,ONOMA_KATHGORIAS,XROMA,MONTELO) VALUES ('EER5161','AUTOKINHTO','GKRI','TOYOTA YARIS');
INSERT INTO OXHMA(ARITHMOS_PINAKIDON,ONOMA_KATHGORIAS,XROMA,MONTELO) VALUES ('EER5208','AUTOKINHTO','MAURO','AUDI A6');
INSERT INTO OXHMA(ARITHMOS_PINAKIDON,ONOMA_KATHGORIAS,XROMA,MONTELO) VALUES ('EER5242','AUTOKINHTO','MPLE','JAGUAR XF');
INSERT INTO OXHMA(ARITHMOS_PINAKIDON,ONOMA_KATHGORIAS,XROMA,MONTELO) VALUES ('EER5255','AUTOKINHTO','LEUKO','LEXUS');
INSERT INTO OXHMA(ARITHMOS_PINAKIDON,ONOMA_KATHGORIAS,XROMA,MONTELO) VALUES ('EER5330','AUTOKINHTO','KOKKINO','FORD MUSTANG');
INSERT INTO OXHMA(ARITHMOS_PINAKIDON,ONOMA_KATHGORIAS,XROMA,MONTELO) VALUES ('EER5410','AUTOKINHTO','LEUKO','HONDA I20');


INSERT INTO ANTIPROSOPEIA ( ONOMA, MONTELO, TIMH, TOPOTHESIA) VALUES ( 'PAPADOPOULOS KIA', 'KIA A32', '1500.1' , ' GEORGIOU 32');
INSERT INTO ANTIPROSOPEIA ( ONOMA, MONTELO, TIMH, TOPOTHESIA) VALUES ( 'IOANNOU CITROEN', 'CINTROEN X12', '8000.0' , ' KOLOKOTRONI 7');
INSERT INTO ANTIPROSOPEIA ( ONOMA, MONTELO, TIMH, TOPOTHESIA) VALUES ( 'PAPADIMITRIOU TOYOTA', 'TOYOTA YARIS', '4356.0' , ' MELA 22');
INSERT INTO ANTIPROSOPEIA ( ONOMA, MONTELO, TIMH, TOPOTHESIA) VALUES ( 'KARAPETROU AUDI', 'AUDI A6', '9891.0' , ' KOLOKOTRONI 47');
INSERT INTO ANTIPROSOPEIA ( ONOMA, MONTELO, TIMH, TOPOTHESIA) VALUES ( 'ANASTASOPOULOS AE', 'HONDA I20', '9256.0' , ' PERIKLI 2');
INSERT INTO ANTIPROSOPEIA ( ONOMA, MONTELO, TIMH, TOPOTHESIA) VALUES ( 'DELIGIANNIDIS PORSCHE', 'PANAMERA PORSCHE', '9356.0' , ' KAPODISTRIA 31');
INSERT INTO ANTIPROSOPEIA ( ONOMA, MONTELO, TIMH, TOPOTHESIA) VALUES ( 'XATDIMOU FORD', 'FORD MUSTANG', '7540.0' , ' EUAGGELOY 8');


INSERT INTO SERVICE ( KOSTOS, XRONOS, ARITHMOS_PINAKIDON) VALUES ('4000', '02:00:00', 'EER5027' );
INSERT INTO SERVICE ( KOSTOS, XRONOS, ARITHMOS_PINAKIDON) VALUES ('2000', '01:30:00', 'EER5085' );
INSERT INTO SERVICE ( KOSTOS, XRONOS, ARITHMOS_PINAKIDON) VALUES ('9000', '00:30:00', 'EER5107' );
INSERT INTO SERVICE ( KOSTOS, XRONOS, ARITHMOS_PINAKIDON) VALUES ('1000', '00:30:00', 'EER5161' );
INSERT INTO SERVICE ( KOSTOS, XRONOS, ARITHMOS_PINAKIDON) VALUES ('9000', '03:30:00', 'EER5208' );
INSERT INTO SERVICE ( KOSTOS, XRONOS, ARITHMOS_PINAKIDON) VALUES ('7000', '01:30:00', 'EER5242' );
INSERT INTO SERVICE ( KOSTOS, XRONOS, ARITHMOS_PINAKIDON) VALUES ('3000', '01:00:00', 'EER5330' );
INSERT INTO SERVICE ( KOSTOS, XRONOS, ARITHMOS_PINAKIDON) VALUES ('2000', '00:30:00', 'EER5410' );


INSERT INTO KRATISI (HMEROMHNIA,TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,ARITHMOS_PINAKIDON) VALUES ('2002-05-13','AM415022','PAPADOPOULOS','IOANNIS','6985404011','EER5027');
INSERT INTO KRATISI (HMEROMHNIA,TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,ARITHMOS_PINAKIDON) VALUES ('2002-05-17','AM415029','KOUTSOS','ASIMAKIS','6984366940','EER5085');
INSERT INTO KRATISI (HMEROMHNIA,TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,ARITHMOS_PINAKIDON) VALUES ('2002-05-14','AM415370','DELIOS','NIKOS','6972460618','EER5107');
INSERT INTO KRATISI (HMEROMHNIA,TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,ARITHMOS_PINAKIDON) VALUES ('2002-07-12','AM415001','ANASTASOPOULOS','VASILEIOS','6985844422','EER5410');
INSERT INTO KRATISI (HMEROMHNIA,TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,ARITHMOS_PINAKIDON) VALUES ('2002-08-21','AM415505','AGGELIDOU','GEORGIA','6987407222','EER5242');
INSERT INTO KRATISI (HMEROMHNIA,TAYTOTHTA,EPITHETO,ONOMA,TILEFONO,ARITHMOS_PINAKIDON) VALUES ('2002-10-10','AM415112','KOLOVOS','VASILEIOS','6985404117','EER5330');


INSERT INTO EKPTOSI (TAYTOTHTA,KRATISEIS,HMEROMHNIA_EGGRAFIS,HMEROMHNIA_KRATHSHS) VALUES ('AM415022','1','2017-06-21','2022-12-31');
INSERT INTO EKPTOSI (TAYTOTHTA,KRATISEIS,HMEROMHNIA_EGGRAFIS,HMEROMHNIA_KRATHSHS) VALUES ('AM415322','3','2021-03-31','2022-12-25');
INSERT INTO EKPTOSI (TAYTOTHTA,KRATISEIS,HMEROMHNIA_EGGRAFIS,HMEROMHNIA_KRATHSHS) VALUES ('AM415370','22','2002-12-12','2023-01-13');
INSERT INTO EKPTOSI (TAYTOTHTA,KRATISEIS,HMEROMHNIA_EGGRAFIS,HMEROMHNIA_KRATHSHS) VALUES ('AM415112','7','2002-12-12','2023-01-13');
INSERT INTO EKPTOSI (TAYTOTHTA,KRATISEIS,HMEROMHNIA_EGGRAFIS,HMEROMHNIA_KRATHSHS) VALUES ('AM415347','11','2008-12-23','2023-01-06');
INSERT INTO EKPTOSI (TAYTOTHTA,KRATISEIS,HMEROMHNIA_EGGRAFIS,HMEROMHNIA_KRATHSHS) VALUES ('AM415505','12','2010-06-30','2023-01-07');

/*selects*/

SELECT * FROM PELATHS WHERE EPITHETO LIKE 'P%';
SELECT * FROM OXHMA WHERE ARITHMOS_PINAKIDON LIKE '%7';
SELECT * FROM OXHMA WHERE MONTELO LIKE '_O%';

/*selects*/

SELECT MAX(HLIKIA) FROM PELATHS;
SELECT MIN(HMEROMHNIA_KRATHSHS) FROM EKPTOSI;
SELECT * FROM SERVICE GROUP BY KOSTOS;
SELECT * FROM ANTIPROSOPEIA GROUP BY TIMH;

/*selcts*/

SELECT pl.TAYTOTHTA,pl.TILEFONO,kr.ARITHMOS_PINAKIDON from PELATHS pl INNER JOIN KRATISI kr ON  pl.TAYTOTHTA = kr.TAYTOTHTA;
SELECT ox.ONOMA_KATHGORIAS, kat.MEGETHOS, ox.MONTELO, ox.XROMA FROM OXHMA ox LEFT JOIN KATHGORIA kat ON ox.ONOMA_KATHGORIAS = kat.ONOMA_KATHGORIAS;

/*creates*/

CREATE VIEW sizeCar AS SELECT ONOMA_KATHGORIAS FROM KATHGORIA WHERE MEGETHOS='MEGALO';
CREATE VIEW lowendCar AS SELECT ONOMA, MONTELO,TIMH FROM ANTIPROSOPEIA WHERE TIMH<=7000;

SELECT * FROM ergasia.sizecar;
SELECT * FROM ergasia.lowendcar;

/*creates*/

DELIMITER $$
CREATE TRIGGER priceCheck BEFORE INSERT ON ANTIPROSOPEIA FOR EACH ROW 
BEGIN 
IF NEW.TIMH<0 THEN SET NEW.TIMH=0 ;
END IF ; 
END$$
DELIMITER ;

DELIMITER $$
CREATE TRIGGER ageChecker BEFORE INSERT ON PELATHS FOR EACH ROW 
BEGIN 
IF NEW.HLIKIA < 18 THEN
SIGNAL SQLSTATE '50001' SET MESSAGE_TEXT = 'Person must be older than 18.';
END IF ; 
END$$
DELIMITER ;


DROP TABLE SERVICE ;  /*1*/
DROP TABLE ANTIPROSOPEIA ;  /*2*/
DROP TABLE EKPTOSI ;  /*4*/
DROP TABLE KRATISI ;  /*7*/
DROP TABLE OXHMA ;  /*5*/
DROP TABLE KATHGORIA ; /*6*/
DROP TABLE PELATHS ;  /*7*/

